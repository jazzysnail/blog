<!DOCTYPE html>
<html>
  <head>
    <title>Leon's blog</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="//at.alicdn.com/t/font_bq7x8lbm8uk81tt9.css"/>
    <link rel="stylesheet" type="text/css" href="/index.css"/>
    <!--[if lt IE 10]>
      <script src="https://as.alipayobjects.com/g/component/??console-polyfill/0.2.2/index.js,es5-shim/4.5.7/es5-shim.min.js,es5-shim/4.5.7/es5-sham.min.js,html5shiv/3.7.2/html5shiv.min.js,media-match/2.0.2/media.match.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div id="react-content"><div class="layout" data-reactroot="" data-reactid="1" data-react-checksum="1117302475"><div class="paper" data-reactid="2"><header class="layout-header" data-reactid="3"><div class="header-content" data-reactid="4"><div class="title" data-reactid="5"><a href="/" data-reactid="6"><img class="logo" src="http://oaul0t4t1.bkt.clouddn.com/imgs/blog-logo.jpg" alt="logo" data-reactid="7"/></a></div><div class="nav" data-reactid="8"><ul data-reactid="9"><li class="to-home" data-reactid="10"><a href="/" data-reactid="11">Home</a></li><li class="" data-reactid="12"><span data-reactid="13">Journal</span></li><li class="hide-in-mobile" data-reactid="14"><span data-reactid="15">Artwork</span></li><li class="" data-reactid="16"><span data-reactid="17">JS</span></li><li class="hide-in-mobile" data-reactid="18"><a href="/about" data-reactid="19">About</a></li></ul></div><div class="header-bottom-line" data-reactid="20"></div></div></header><div class="layout-content" data-reactid="21"><div class="post-info" data-reactid="22"><span data-reactid="23"><i class="mineicon mineicon-clock" data-reactid="24"></i><time data-reactid="25">2017-11-13</time></span><span data-reactid="26"><i class="mineicon mineicon-sale" data-reactid="27"></i><span class="tags" data-reactid="28"><a href="/" data-reactid="29">JS</a></span></span></div><h1 data-reactid="30">New</h1><div class="entry-content" data-reactid="31"><article data-reactid="32"><h2 data-reactid="33"><!-- react-text: 34 -->Object<!-- /react-text --></h2><p data-reactid="35"><!-- react-text: 36 -->Object 的内部属性使用 [<!-- /react-text --><!-- react-text: 37 -->[prototype]<!-- /react-text --><!-- react-text: 38 -->] 来表示对象的原型，在大多数的 js 内核的实现中使用 <!-- /react-text --><code data-reactid="39"><!-- react-text: 40 -->__proto__<!-- /react-text --></code><!-- react-text: 41 --> 属性，如 chrome。<!-- /react-text --></p><h2 data-reactid="42"><!-- react-text: 43 -->Function<!-- /react-text --></h2><p data-reactid="44"><!-- react-text: 45 -->Function 的 实例属性 <!-- /react-text --><code data-reactid="46"><!-- react-text: 47 -->prototype<!-- /react-text --></code><!-- react-text: 48 --> 的值用于初始化一个新创建对象的的 [<!-- /react-text --><!-- react-text: 49 -->[prototype]<!-- /react-text --><!-- react-text: 50 -->] 内部属性，为了这个新创建对象要先将函数对象作为构造器调用。这个属性拥有特性 { [<!-- /react-text --><!-- react-text: 51 -->[writable]<!-- /react-text --><!-- react-text: 52 -->]: true, [<!-- /react-text --><!-- react-text: 53 -->[enumerable]<!-- /react-text --><!-- react-text: 54 -->]: false, [<!-- /react-text --><!-- react-text: 55 -->[configurable]<!-- /react-text --><!-- react-text: 56 -->]: false }。<!-- /react-text --></p><h2 data-reactid="57"><!-- react-text: 58 -->Constructor<!-- /react-text --></h2><p data-reactid="59"><!-- react-text: 60 -->构造器的 <!-- /react-text --><code data-reactid="61"><!-- react-text: 62 -->prototype<!-- /react-text --></code><!-- react-text: 63 --> 属性值是一个原型对象，它用来实现继承和共享属性。<!-- /react-text --></p><h2 data-reactid="64"><!-- react-text: 65 -->Prototype<!-- /react-text --></h2><p data-reactid="66"><!-- react-text: 67 -->当构造器创建一个对象，为了解决对象的属性引用，该对象会隐式引用构造器的 <!-- /react-text --><code data-reactid="68"><!-- react-text: 69 -->prototype<!-- /react-text --></code><!-- react-text: 70 --> 属性。通过程序表达式 <!-- /react-text --><code data-reactid="71"><!-- react-text: 72 -->constructor.prototype<!-- /react-text --></code><!-- react-text: 73 --> 可以引用到构造器的 <!-- /react-text --><code data-reactid="74"><!-- react-text: 75 -->prototype<!-- /react-text --></code><!-- react-text: 76 --> 属性，并且添加到对象原型里的属性，会通过继承与所有共享此原型的对象共享。另外，可使用 Object.create 内置函数，通过明确指定原型来创建一个新对象。<!-- /react-text --></p><h2 data-reactid="77"><!-- react-text: 78 -->New<!-- /react-text --></h2><p data-reactid="79"><!-- react-text: 80 -->产生式 NewExpression : new NewExpression 按照下面的过程执行 :<!-- /react-text --></p><ol data-reactid="81"><li data-reactid="82"><p data-reactid="83"><!-- react-text: 84 -->令 ref 为解释执行 NewExpression 的结果 .<!-- /react-text --></p></li><li data-reactid="85"><p data-reactid="86"><!-- react-text: 87 -->令 constructor 为 GetValue(ref).<!-- /react-text --></p></li><li data-reactid="88"><p data-reactid="89"><!-- react-text: 90 -->如果 Type(constructor) is not Object ，抛出一个 TypeError 异常 .<!-- /react-text --></p></li><li data-reactid="91"><p data-reactid="92"><!-- react-text: 93 -->如果 constructor 没有实现 [<!-- /react-text --><!-- react-text: 94 -->[construct]<!-- /react-text --><!-- react-text: 95 -->] 内置方法 ，抛出一个 TypeError 异常 .<!-- /react-text --></p></li><li data-reactid="96"><p data-reactid="97"><!-- react-text: 98 -->返回调用 constructor 的 [<!-- /react-text --><!-- react-text: 99 -->[construct]<!-- /react-text --><!-- react-text: 100 -->] 内置方法的结果 , 传入按无参数传入参数列表 ( 就是一个空的参数列表 ).<!-- /react-text --></p></li></ol><p data-reactid="101"><!-- react-text: 102 -->产生式 MemberExpression : new MemberExpression Arguments 按照下面的过程执行 :<!-- /react-text --></p><ol data-reactid="103"><li data-reactid="104"><p data-reactid="105"><!-- react-text: 106 -->令 ref 为解释执行 MemberExpression 的结果 .<!-- /react-text --></p></li><li data-reactid="107"><p data-reactid="108"><!-- react-text: 109 -->令 constructor 为 GetValue(ref).<!-- /react-text --></p></li><li data-reactid="110"><p data-reactid="111"><!-- react-text: 112 -->令 argList 为解释执行 Arguments 的结果 , 产生一个由参数值构成的内部列表类型 (11.2.4).<!-- /react-text --></p></li><li data-reactid="113"><p data-reactid="114"><!-- react-text: 115 -->如果 Type(constructor) is not Object ，抛出一个 TypeError 异常 .<!-- /react-text --></p></li><li data-reactid="116"><p data-reactid="117"><!-- react-text: 118 -->如果 constructor 没有实现 [<!-- /react-text --><!-- react-text: 119 -->[construct]<!-- /react-text --><!-- react-text: 120 -->] 内置方法，抛出一个 TypeError 异常 .<!-- /react-text --></p></li><li data-reactid="121"><p data-reactid="122"><!-- react-text: 123 -->返回以 argList 为参数调用 constructor 的 [<!-- /react-text --><!-- react-text: 124 -->[construct]<!-- /react-text --><!-- react-text: 125 -->] 内置方法的结果 .<!-- /react-text --></p></li></ol><p data-reactid="126"><strong data-reactid="127"><!-- react-text: 128 -->Note:<!-- /react-text --></strong><!-- react-text: 129 --> <!-- /react-text --><code data-reactid="130"><!-- react-text: 131 -->NewExpression<!-- /react-text --></code><!-- react-text: 132 --> 为对象创建表达式，<!-- /react-text --><code data-reactid="133"><!-- react-text: 134 -->MemberExpression<!-- /react-text --></code><!-- react-text: 135 --> 为成员表达式，<!-- /react-text --><code data-reactid="136"><!-- react-text: 137 -->GetValue<!-- /react-text --></code><!-- react-text: 138 --> 为引用规范类型获取具体值的方法，参看 ES 规范 <!-- /react-text --><strong data-reactid="139"><!-- react-text: 140 --> 左值表达式<!-- /react-text --></strong><!-- react-text: 141 --> 部分和 <!-- /react-text --><strong data-reactid="142"><!-- react-text: 143 -->引用规范类型<!-- /react-text --></strong><!-- react-text: 144 --> 部分。<!-- /react-text --></p><p data-reactid="145"><!-- react-text: 146 -->细心会发现，依据不同的产生式，步骤有一些差别。其实这个差别看起来就像是 <!-- /react-text --><code data-reactid="147"><!-- react-text: 148 -->new Object<!-- /react-text --></code><!-- react-text: 149 --> 和 <!-- /react-text --><code data-reactid="150"><!-- react-text: 151 -->new Object(...argList)<!-- /react-text --></code><!-- react-text: 152 --> 的差别，如果 <!-- /react-text --><code data-reactid="153"><!-- react-text: 154 -->argList<!-- /react-text --></code><!-- react-text: 155 --> 为空应该是无差别的。前面是构造器，其实就构造函数而言还有一种差别是 <!-- /react-text --><code data-reactid="156"><!-- react-text: 157 -->Date()<!-- /react-text --></code><!-- react-text: 158 --> 和 <!-- /react-text --><code data-reactid="159"><!-- react-text: 160 -->new Date()<!-- /react-text --></code><!-- react-text: 161 --> 的差别，可以通过在构造器内部使用 <!-- /react-text --><code data-reactid="162"><!-- react-text: 163 -->instanceof<!-- /react-text --></code><!-- react-text: 164 --> 操作符来进行安全类型检测，不多写。<!-- /react-text --></p><p data-reactid="165"><!-- react-text: 166 -->根据规范原理描述，我们大致可以以下步骤作为简单的实现：<!-- /react-text --></p><ol data-reactid="167"><li data-reactid="168"><p data-reactid="169"><!-- react-text: 170 -->创建一个空对象<!-- /react-text --></p></li><li data-reactid="171"><p data-reactid="172"><!-- react-text: 173 -->绑定原型<!-- /react-text --></p></li><li data-reactid="174"><p data-reactid="175"><!-- react-text: 176 -->以 <!-- /react-text --><code data-reactid="177"><!-- react-text: 178 -->argList<!-- /react-text --></code><!-- react-text: 179 --> 为入参执行构造函数，函数 this 指向新的对象<!-- /react-text --></p></li><li data-reactid="180"><p data-reactid="181"><!-- react-text: 182 -->返回该对象<!-- /react-text --></p></li></ol><p data-reactid="183"><!-- react-text: 184 -->简单书写一下：<!-- /react-text --></p><pre class="language-js" data-reactid="185"><code data-reactid="186"><span class="token keyword">const</span> _new <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>constructor<span class="token punctuation">,</span> <span class="token operator">...</span>argList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> _object <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  _object<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> constructor<span class="token punctuation">.</span>prototype
  constructor<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>_object<span class="token punctuation">,</span> <span class="token operator">...</span>argList<span class="token punctuation">)</span>
  <span class="token keyword">return</span> _object
<span class="token punctuation">}</span></code></pre><pre class="language-js" data-reactid="187"><code data-reactid="188"><span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>base <span class="token operator">=</span> val2
<span class="token punctuation">}</span>

v<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>getValue <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>base
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// NewExpression : new NewExpression</span>
<span class="token keyword">const</span> _v <span class="token operator">=</span> <span class="token function">_new</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// MemberExpression : new MemberExpression Arguments</span>
<span class="token keyword">const</span> _vv <span class="token operator">=</span> <span class="token function">_new</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>

_v <span class="token keyword">instanceof</span> <span class="token class-name">v</span> <span class="token comment" spellcheck="true">// => true</span>
_vv <span class="token keyword">instanceof</span> <span class="token class-name">v</span> <span class="token comment" spellcheck="true">// => true</span></code></pre><p data-reactid="189"><!-- react-text: 190 -->:完<!-- /react-text --></p></article></div><div data-reactid="191"><div class="blog-star" data-reactid="192"><iframe src="https://ghbtns.com/github-btn.html?user=jazzysnail&amp;repo=blog&amp;type=star&amp;count=true&amp;size=small" scrolling="0" data-reactid="193"></iframe></div></div><div class="post-footer" data-reactid="194"><div class="post-footer-line" data-reactid="195"></div><a class="previous" href="posts/ES-reference" data-reactid="196"><i class="mineicon mineicon-arrowleft" data-reactid="197"></i><!-- react-text: 198 --> <!-- /react-text --><span class="label" data-reactid="199">prev</span><span class="post-title" data-reactid="200">尝试为 js 实现引用传递</span></a><div class="comment-tip" data-reactid="201"><span data-reactid="202">⌘ + enter post comment</span></div><a class="next" href="posts/fluent-design-system" data-reactid="203"><span class="post-title" data-reactid="204">来聊一聊流畅设计系统（草稿）</span><span class="label" data-reactid="205">next</span><!-- react-text: 206 --> <!-- /react-text --><i class="mineicon mineicon-arrowright" data-reactid="207"></i></a></div></div></div><footer data-reactid="208"><span class="linkup" data-reactid="209"><a href="http://github.com/jazzysnail" target="_blank" data-reactid="210"><i class="mineicon mineicon-github" data-reactid="211"></i></a><a href="http://2017.zcool.com.cn/u/2061043" target="_blank" data-reactid="212"><i class="mineicon mineicon-zcool" data-reactid="213"></i></a></span><p data-reactid="214"><!-- react-text: 215 -->All Content Copyright © <!-- /react-text --><!-- react-text: 216 -->2016<!-- /react-text --><!-- react-text: 217 -->-<!-- /react-text --><!-- react-text: 218 -->2017<!-- /react-text --><!-- react-text: 219 --> leon’s blog<!-- /react-text --></p><p style="color:#ccc;" data-reactid="220"><!-- react-text: 221 -->Powered by <!-- /react-text --><a href="https://github.com/benjycui/bisheng" target="_blank" data-reactid="222">Bisheng</a></p></footer></div></div>
  </body>
  <script src="/common.js"></script>
  <script src="/index.js"></script>
</html>