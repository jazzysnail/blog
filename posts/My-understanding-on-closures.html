<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="//at.alicdn.com/t/font_bq7x8lbm8uk81tt9.css"/>
    <link rel="stylesheet" type="text/css" href="/blog/index.css"/>
    <!--[if lt IE 10]>
      <script src="https://as.alipayobjects.com/g/component/??console-polyfill/0.2.2/index.js,es5-shim/4.5.7/es5-shim.min.js,es5-shim/4.5.7/es5-sham.min.js,html5shiv/3.7.2/html5shiv.min.js,media-match/2.0.2/media.match.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div id="react-content"><div class="layout" data-reactroot="" data-reactid="1" data-react-checksum="864077842"><div class="paper" data-reactid="2"><header class="layout-header" data-reactid="3"><div class="header-content" data-reactid="4"><div class="title" data-reactid="5"><a href="/" data-reactid="6">jazzysnail</a></div><div class="nav" data-reactid="7"><ul data-reactid="8"><li data-reactid="9"><a href="/" data-reactid="10">Journal</a></li><li data-reactid="11"><a href="/" data-reactid="12">Art</a></li><li data-reactid="13"><a href="/" data-reactid="14">JS</a></li><li data-reactid="15"><a href="/" data-reactid="16">About</a></li><li data-reactid="17"><a href="/" data-reactid="18">Findme</a></li></ul></div></div></header><div class="layout-content" data-reactid="19"><div class="post-info" data-reactid="20"><span data-reactid="21"><i class="mineicon mineicon-clock" data-reactid="22"></i><time data-reactid="23">2016-07-18</time></span><span data-reactid="24"><i class="mineicon mineicon-sale" data-reactid="25"></i><span class="tags" data-reactid="26"><a href="/" data-reactid="27">javascript</a><a href="/" data-reactid="28">closure</a></span></span></div><h1 data-reactid="29">关于闭包之我见</h1><div class="entry-content" data-reactid="30"><article data-reactid="31"><p data-reactid="32"><!-- react-text: 33 -->这他么的什么鬼？到底什么是闭包？<!-- /react-text --></p><p data-reactid="34"><!-- react-text: 35 -->接触前端不久，我也不太懂闭包，但感觉貌似好腻害研究一哈，特别感谢大师兄的栗子！（以下理解纯属个人理解，不一定正确和准确，欢迎讨论）<!-- /react-text --></p><p data-reactid="36"><!-- react-text: 37 -->研究开始...<!-- /react-text --></p><p data-reactid="38"><!-- react-text: 39 -->闭包，我的理解就是一个利用函数作用域，创建了一个中间变量表达式，内部代码执行依赖闭包中的变量，而内部又被外部引用。因此只要内部函数需要的资源都不会被回收，该闭包中的变量也不会被回收。<!-- /react-text --></p><p data-reactid="40"><!-- react-text: 41 -->也就是在函数外套了个罩子，这个罩子就是闭包。这个罩子把外部和内部隔离开，罩子里的变量可以被内部调用且又不能被外部调用，而且还不能被回收掉！下面是一个闭包的栗子：<!-- /react-text --></p><pre class="language-js" data-reactid="42"><code data-reactid="43"><span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
onclick <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p data-reactid="44"><!-- react-text: 45 -->函数b嵌套在函数a中，函数a返回函数b，变量c引用函数a。<!-- /react-text --></p><p data-reactid="46"><!-- react-text: 47 -->当执行c()时由于函数a返回函数b所以实际上函数指向b，b的执行依赖函数a中的变量i，所以当函数执行过后a中的变量i的值不会被回收。当再次触发点击事件时会输出++i。喜闻乐见的反例：<!-- /react-text --></p><pre class="language-js" data-reactid="48"><code data-reactid="49"><span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// return b;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
onclick <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p data-reactid="50"><!-- react-text: 51 -->假如我们不返回函数b而是直接执行函数b，会是什么情况呢？<!-- /react-text --></p><p data-reactid="52"><!-- react-text: 53 -->实际上当函数执行时函数直接指向a，a内部函数b直接执行并没有作为返回值返回给外部，这时内部函数b与外部函数完全没有什么关系（自娱自乐）因此函数a中的资源（变量i）就被回收了，所以当再次触发点击事件的时候打印出的还是1，而且将永远是1，变量i并没有被加上去。<!-- /react-text --></p><p data-reactid="54"><!-- react-text: 55 -->到底有什么卵用？
<!-- /react-text --><strong data-reactid="56"><!-- react-text: 57 -->保持一个变量常住内存，保护函数内部变量不被回收！<!-- /react-text --></strong><!-- react-text: 58 -->下面是一个完整的栗子：<!-- /react-text --></p><pre class="language-html" data-reactid="59"><code data-reactid="60"><span class="token doctype">&lt;!DOCTYPE html></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>haha1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>这是第1个div<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>haha2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>这是第2个div<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>haha3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>这是第3个div<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>haha4<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>这是第4个div<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>haha5<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>这是第5个div<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>haha6<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>这是第6个div<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>haha7<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>这是第7个div<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>haha8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>这是第8个div<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>haha9<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>这是第9个div<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>haha10<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>这是第10个div<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span>
for (var i = 1; i &lt;= 10; i++) {

    document.querySelector("#haha" + i).addEventListener('click', function() {
        console.log("第一个方式", i);
    });

    (function(i) {
        document.querySelector("#haha" + i).addEventListener('click', function() {
            console.log("第二个方式", i);
        });
    })(i);
}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p data-reactid="61"><strong data-reactid="62"><!-- react-text: 63 -->建议复制下来执行一下<!-- /react-text --></strong><!-- react-text: 64 -->
代码什么意思呢？<!-- /react-text --></p><p data-reactid="65"><!-- react-text: 66 -->给这十个div都绑定一个点击事件，来控制台打印div的索引值（就等于闭包函数的i值）。<!-- /react-text --></p><p data-reactid="67"><!-- react-text: 68 -->方式一、没有使用闭包，只是单纯的给每一个div绑定了点击事件，内部方法打印的i即为全局变量i（即为for循环后留下的变量i，值为11）。<!-- /react-text --></p><p data-reactid="69"><!-- react-text: 70 -->方式二、使用了闭包，每当循环执行一次就给当前div绑定点击事件时同时创建一个闭包，闭包里的变量i即为创建时当前i的值，当相应的div触发点击事件时打印出的即为相应绑定时i的值。<!-- /react-text --></p><p data-reactid="71"><!-- react-text: 72 -->这样闭包就很好的保护了内部函数所使用的是当时的i而不是全局下的i。是不是感觉吊吊的？？<!-- /react-text --></p><p data-reactid="73"><strong data-reactid="74"><!-- react-text: 75 -->总结：<!-- /react-text --></strong></p><blockquote data-reactid="76"><p data-reactid="77"><!-- react-text: 78 -->一个拥有许多变量和绑定了这些变量的环境的表达式（通常是一个函数），因而这些变量也是该表达式的一部分。
回过头来看这句话应该理解了不少，虽然还是有点模糊，但起码会用了不是么？<!-- /react-text --><strong data-reactid="79"><!-- react-text: 80 -->保持一个变量常住内存，保护函数内部变量不被回收也不被覆盖。<!-- /react-text --></strong></p></blockquote><p data-reactid="81"><!-- react-text: 82 -->写到这里应该可以简单的理解javascript的闭包了~<!-- /react-text --></p><p data-reactid="83"><!-- react-text: 84 -->由csdn《<!-- /react-text --><a href="http://blog.csdn.net/jazzysnail/article/details/49301283" data-reactid="85"><!-- react-text: 86 -->关于闭包之我见<!-- /react-text --></a><!-- react-text: 87 -->》 2015-10-21 10:45 转移至此<!-- /react-text --></p></article></div><div class="post-footer" data-reactid="88"><a class="previous" data-reactid="89"><i class="mineicon mineicon-arrowleft" data-reactid="90"></i><!-- react-text: 91 --> prev<!-- /react-text --></a><span data-reactid="92">⌘+e back to news  ⌘+enter post comment</span><a class="next" data-reactid="93"><!-- react-text: 94 -->next <!-- /react-text --><i class="mineicon mineicon-arrowright" data-reactid="95"></i></a></div></div></div><footer data-reactid="96"><span class="linkup" data-reactid="97"><a href="http://github.com/jazzysnail" target="_blank" data-reactid="98"><i class="mineicon mineicon-github" data-reactid="99"></i></a><a href="http://2017.zcool.com.cn/u/2061043" target="_blank" data-reactid="100"><i class="mineicon mineicon-zcool" data-reactid="101"></i></a></span><p data-reactid="102"><!-- react-text: 103 -->2016<!-- /react-text --><!-- react-text: 104 -->-<!-- /react-text --><!-- react-text: 105 -->2017<!-- /react-text --><!-- react-text: 106 --> leon’s blog Powered by <!-- /react-text --><a href="https://github.com/benjycui/bisheng" data-reactid="107">Bisheng</a></p></footer></div></div>
  </body>
  <script src="/blog/common.js"></script>
  <script src="/blog/index.js"></script>
</html>