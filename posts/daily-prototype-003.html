<!DOCTYPE html>
<html>
  <head>
    <title>Leon's blog</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="//at.alicdn.com/t/font_bq7x8lbm8uk81tt9.css"/>
    <link rel="stylesheet" type="text/css" href="/index.css"/>
    <!--[if lt IE 10]>
      <script src="https://as.alipayobjects.com/g/component/??console-polyfill/0.2.2/index.js,es5-shim/4.5.7/es5-shim.min.js,es5-shim/4.5.7/es5-sham.min.js,html5shiv/3.7.2/html5shiv.min.js,media-match/2.0.2/media.match.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div id="react-content"><div class="layout" data-reactroot="" data-reactid="1" data-react-checksum="-1409944312"><div class="paper" data-reactid="2"><header class="layout-header" data-reactid="3"><div class="header-content" data-reactid="4"><div class="title" data-reactid="5"><a href="/" data-reactid="6"><img class="logo" src="http://oaul0t4t1.bkt.clouddn.com/imgs/blog-logo.jpg" alt="logo" data-reactid="7"/></a></div><div class="nav" data-reactid="8"><ul data-reactid="9"><li class="to-home" data-reactid="10"><a href="/" data-reactid="11">Home</a></li><li class="" data-reactid="12"><span data-reactid="13">Journal</span></li><li class="hide-in-mobile" data-reactid="14"><span data-reactid="15">Artwork</span></li><li class="" data-reactid="16"><span data-reactid="17">JS</span></li><li class="hide-in-mobile" data-reactid="18"><a href="/about" data-reactid="19">About</a></li></ul></div><div class="header-bottom-line" data-reactid="20"></div></div></header><div class="layout-content" data-reactid="21"><div class="post-info" data-reactid="22"><span data-reactid="23"><i class="mineicon mineicon-clock" data-reactid="24"></i><time data-reactid="25">2017-05-29</time></span><span data-reactid="26"><i class="mineicon mineicon-sale" data-reactid="27"></i><span class="tags" data-reactid="28"><a href="/" data-reactid="29">JS</a><a href="/" data-reactid="30">Array</a></span></span></div><h1 data-reactid="31">map &amp; reduce</h1><div class="entry-content" data-reactid="32"><article data-reactid="33"><p data-reactid="34"><br data-reactid="35"/></p><h1 data-reactid="36"><!-- react-text: 37 -->Array.prototype.map()<!-- /react-text --></h1><hr data-reactid="38"/><blockquote data-reactid="39"><p data-reactid="40"><!-- react-text: 41 -->map() 方法创建一个新数组，其结果是该数组中的每个元素调用一个提供的函数。<!-- /react-text --></p></blockquote><p data-reactid="42"><!-- react-text: 43 -->意如其名，就是一个数组到另一个数组的映射。<!-- /react-text --></p><h2 data-reactid="44"><!-- react-text: 45 -->语法<!-- /react-text --></h2><pre class="language-js" data-reactid="46"><code data-reactid="47"><span class="token keyword">const</span> new_array <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>callback<span class="token punctuation">[</span><span class="token punctuation">,</span> thisArg<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><h2 data-reactid="48"><!-- react-text: 49 -->参数<!-- /react-text --></h2><ul data-reactid="50"><li data-reactid="51"><p data-reactid="52"><code data-reactid="53"><!-- react-text: 54 -->callback<!-- /react-text --></code><!-- react-text: 55 -->生成新数组元素的函数，使用三个参数：<!-- /react-text --></p><ul data-reactid="56"><li data-reactid="57"><p data-reactid="58"><code data-reactid="59"><!-- react-text: 60 -->currentValue<!-- /react-text --></code><!-- react-text: 61 --> callback 的第一个参数，数组中正在处理的当前元素。<!-- /react-text --></p></li><li data-reactid="62"><p data-reactid="63"><code data-reactid="64"><!-- react-text: 65 -->index<!-- /react-text --></code><!-- react-text: 66 --> callback 的第二个参数，数组中正在处理的当前元素的索引。<!-- /react-text --></p></li><li data-reactid="67"><p data-reactid="68"><code data-reactid="69"><!-- react-text: 70 -->array<!-- /react-text --></code><!-- react-text: 71 --> callback 的第三个参数，map 方法被调用的数组。<!-- /react-text --></p></li></ul></li><li data-reactid="72"><p data-reactid="73"><code data-reactid="74"><!-- react-text: 75 -->thisArg<!-- /react-text --></code><!-- react-text: 76 -->
可选的。执行 callback 函数时使用的 this 值。<!-- /react-text --></p></li></ul><h2 data-reactid="77"><!-- react-text: 78 -->返回值<!-- /react-text --></h2><p data-reactid="79"><!-- react-text: 80 -->一个新数组，每个元素都是回调函数的结果。同样的，过程不破坏原数组。<!-- /react-text --></p><h2 data-reactid="81"><!-- react-text: 82 -->事例<!-- /react-text --></h2><p data-reactid="83"><!-- react-text: 84 -->计算绝对值（使用 <!-- /react-text --><strong data-reactid="85"><!-- react-text: 86 -->声明式<!-- /react-text --></strong><!-- react-text: 87 --> 替代 <!-- /react-text --><strong data-reactid="88"><!-- react-text: 89 -->命令式<!-- /react-text --></strong><!-- react-text: 90 --> ）：<!-- /react-text --></p><pre class="language-js" data-reactid="91"><code data-reactid="92"><span class="token comment" spellcheck="true">// 使用 Array.prototype.map() 替代 forEach</span>
<span class="token comment" spellcheck="true">// 到绝对值的映射</span>
<span class="token keyword">const</span> semeNumbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 声明式</span>
<span class="token keyword">const</span> absNumbers <span class="token operator">=</span> semeNumbers<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span>abs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 命令式</span>
<span class="token keyword">let</span> absNumbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
semeNumbers<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>val <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  sqrtNumbers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p data-reactid="93"><br data-reactid="94"/></p><h1 data-reactid="95"><!-- react-text: 96 -->Array.prototype.reduce()<!-- /react-text --></h1><hr data-reactid="97"/><blockquote data-reactid="98"><p data-reactid="99"><!-- react-text: 100 -->reduce() 方法对累加器和数组中的每个元素 (从左到右)应用一个函数，将其减少为单个值。<!-- /react-text --></p></blockquote><p data-reactid="101"><!-- react-text: 102 -->反转累器加起点使用 <!-- /react-text --><code data-reactid="103"><!-- react-text: 104 -->Array.prototype.reduceRight()<!-- /react-text --></code><!-- react-text: 105 --> (从右到左)。<!-- /react-text --></p><h2 data-reactid="106"><!-- react-text: 107 -->语法<!-- /react-text --></h2><pre class="language-js" data-reactid="108"><code data-reactid="109">arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span><span class="token punctuation">[</span>initialValue<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><h2 data-reactid="110"><!-- react-text: 111 -->参数<!-- /react-text --></h2><ul data-reactid="112"><li data-reactid="113"><p data-reactid="114"><code data-reactid="115"><!-- react-text: 116 -->callback执行数组中每个值的函数，包含四个参数<!-- /react-text --></code></p><ul data-reactid="117"><li data-reactid="118"><p data-reactid="119"><code data-reactid="120"><!-- react-text: 121 -->accumulator<!-- /react-text --></code><!-- react-text: 122 --> 上一次调用回调返回的值，或者是提供的初始值（initialValue）<!-- /react-text --></p></li><li data-reactid="123"><p data-reactid="124"><code data-reactid="125"><!-- react-text: 126 -->currentValue<!-- /react-text --></code><!-- react-text: 127 --> 数组中正在处理的元素<!-- /react-text --></p></li><li data-reactid="128"><p data-reactid="129"><code data-reactid="130"><!-- react-text: 131 -->currentIndex<!-- /react-text --></code><!-- react-text: 132 --> 数据中正在处理的元素索引，如果提供了 initialValue ，从0开始；否则从1开始<!-- /react-text --></p></li><li data-reactid="133"><p data-reactid="134"><code data-reactid="135"><!-- react-text: 136 -->array<!-- /react-text --></code><!-- react-text: 137 --> 调用 reduce 的数组<!-- /react-text --></p></li></ul></li><li data-reactid="138"><p data-reactid="139"><code data-reactid="140"><!-- react-text: 141 -->initialValue<!-- /react-text --></code><!-- react-text: 142 --> 可选项，其值用于第一次调用 callback 的第一个参数。<!-- /react-text --></p></li></ul><h2 data-reactid="143"><!-- react-text: 144 -->返回值<!-- /react-text --></h2><p data-reactid="145"><!-- react-text: 146 -->累加所求得的结果。同样的，过程不破坏原数组。<!-- /react-text --></p><h2 data-reactid="147"><!-- react-text: 148 -->事例<!-- /react-text --></h2><p data-reactid="149"><!-- react-text: 150 -->简单的相加：<!-- /react-text --></p><pre class="language-js" data-reactid="151"><code data-reactid="152"><span class="token keyword">const</span> total <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>acc<span class="token punctuation">,</span> cur<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> acc <span class="token operator">+</span> cur<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// total is 6</span></code></pre><p data-reactid="153"><!-- react-text: 154 -->数组扁平化：<!-- /react-text --></p><pre class="language-js" data-reactid="155"><code data-reactid="156"><span class="token keyword">const</span> flattened <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>acc<span class="token punctuation">,</span> cur<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> acc<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// flattened is [0, 1, 2, 3, 4, 5]</span></code></pre><p data-reactid="157"><!-- react-text: 158 -->计算数组中各个值出现次数（使用 <!-- /react-text --><strong data-reactid="159"><!-- react-text: 160 -->声明式<!-- /react-text --></strong><!-- react-text: 161 --> 替代 <!-- /react-text --><strong data-reactid="162"><!-- react-text: 163 -->命令式<!-- /react-text --></strong><!-- react-text: 164 --> ）：<!-- /react-text --></p><pre class="language-js" data-reactid="165"><code data-reactid="166"><span class="token keyword">const</span> names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Alice'</span><span class="token punctuation">,</span> <span class="token string">'Bob'</span><span class="token punctuation">,</span> <span class="token string">'Tiff'</span><span class="token punctuation">,</span> <span class="token string">'Bruce'</span><span class="token punctuation">,</span> <span class="token string">'Alice'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> countedNames <span class="token operator">=</span> names<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>allNames<span class="token punctuation">,</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  allNames<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> name <span class="token keyword">in</span> allNames
  <span class="token operator">?</span> allNames<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span>
  <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> allNames<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// countedNames is { 'Alice': 2, 'Bob': 1, 'Tiff': 1, 'Bruce': 1 }</span></code></pre><p data-reactid="167"><br data-reactid="168"/></p><h1 data-reactid="169"><!-- react-text: 170 -->题外话<!-- /react-text --></h1><hr data-reactid="171"/><p data-reactid="172"><!-- react-text: 173 -->本篇有提到两个有趣的例子，一个是求绝对值，一个是计算数组中元素出现次数的例子。下面我们来分析一下，这两个例子。<!-- /react-text --></p><p data-reactid="174"><!-- react-text: 175 -->关于 <!-- /react-text --><strong data-reactid="176"><!-- react-text: 177 -->声明式代码<!-- /react-text --></strong><!-- react-text: 178 --> ,首先要问为什么。我们一直在利用编程来告诉计算机要怎么做，这看起来似乎很合理。但是仔细想一想，我们其实是想通过计算机来得到我们想要的结果。<!-- /react-text --></p><p data-reactid="179"><!-- react-text: 180 -->回看求绝对值的例子，命令式的代码反映出的程序思想是，告诉计算机你应该利用循环来遍历数组将每一个元素取绝对值然后放进一个事先声明的变量数组，以此来得到一个包含原数组所有元素求绝对值后的新的数组。<!-- /react-text --></p><p data-reactid="181"><!-- react-text: 182 -->而使用数组的 <!-- /react-text --><strong data-reactid="183"><!-- react-text: 184 -->高阶函数<!-- /react-text --></strong><!-- react-text: 185 --> <!-- /react-text --><code data-reactid="186"><!-- react-text: 187 -->map()<!-- /react-text --></code><!-- react-text: 188 --> 则反映出我们只是想要得到一个关于绝对值映射的新数组而已。<!-- /react-text --></p><p data-reactid="189"><!-- react-text: 190 -->仔细观察发现我将所有可以使用 <!-- /react-text --><code data-reactid="191"><!-- react-text: 192 -->const<!-- /react-text --></code><!-- react-text: 193 --> 的地方均使用 <!-- /react-text --><code data-reactid="194"><!-- react-text: 195 -->const<!-- /react-text --></code><!-- react-text: 196 --> 替代了 <!-- /react-text --><code data-reactid="197"><!-- react-text: 198 -->let<!-- /react-text --></code><!-- react-text: 199 --> 或者 <!-- /react-text --><code data-reactid="200"><!-- react-text: 201 -->var<!-- /react-text --></code><!-- react-text: 202 -->。原因是我想突出，声明而非命令。甚至我还吹毛求疵的将 <!-- /react-text --><code data-reactid="203"><!-- react-text: 204 -->if<!-- /react-text --></code><!-- react-text: 205 --> 语句使用三目运算符进行了替换。<!-- /react-text --></p><p data-reactid="206"><!-- react-text: 207 -->原因在于 <!-- /react-text --><code data-reactid="208"><!-- react-text: 209 -->if<!-- /react-text --></code><!-- react-text: 210 --> 更倾向于判断或者是运算分支，而我们实际上想做的事情是操作某对象的键值而已。这样一来编程将更倾向于自然目的，而非告诉计算机该怎么做。<!-- /react-text --></p></article></div><div data-reactid="211"><div class="blog-star" data-reactid="212"><iframe src="https://ghbtns.com/github-btn.html?user=jazzysnail&amp;repo=blog&amp;type=star&amp;count=true&amp;size=small" scrolling="0" data-reactid="213"></iframe></div></div><div class="post-footer" data-reactid="214"><div class="post-footer-line" data-reactid="215"></div><a class="previous" href="posts/daily-prototype-004" data-reactid="216"><i class="mineicon mineicon-arrowleft" data-reactid="217"></i><!-- react-text: 218 --> <!-- /react-text --><span class="label" data-reactid="219">prev</span><span class="post-title" data-reactid="220">filter</span></a><div class="comment-tip" data-reactid="221"><span data-reactid="222">⌘ + enter post comment</span></div><a class="next" href="posts/daily-prototype-002" data-reactid="223"><span class="post-title" data-reactid="224">every &amp; some</span><span class="label" data-reactid="225">next</span><!-- react-text: 226 --> <!-- /react-text --><i class="mineicon mineicon-arrowright" data-reactid="227"></i></a></div></div></div><footer data-reactid="228"><span class="linkup" data-reactid="229"><a href="http://github.com/jazzysnail" target="_blank" data-reactid="230"><i class="mineicon mineicon-github" data-reactid="231"></i></a><a href="http://2017.zcool.com.cn/u/2061043" target="_blank" data-reactid="232"><i class="mineicon mineicon-zcool" data-reactid="233"></i></a></span><p data-reactid="234"><!-- react-text: 235 -->All Content Copyright © <!-- /react-text --><!-- react-text: 236 -->2016<!-- /react-text --><!-- react-text: 237 -->-<!-- /react-text --><!-- react-text: 238 -->2017<!-- /react-text --><!-- react-text: 239 --> leon’s blog<!-- /react-text --></p><p style="color:#ccc;" data-reactid="240"><!-- react-text: 241 -->Powered by <!-- /react-text --><a href="https://github.com/benjycui/bisheng" target="_blank" data-reactid="242">Bisheng</a></p></footer></div></div>
  </body>
  <script src="/common.js"></script>
  <script src="/index.js"></script>
</html>