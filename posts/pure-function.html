<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="//at.alicdn.com/t/font_bq7x8lbm8uk81tt9.css"/>
    <link rel="stylesheet" type="text/css" href="/index.css"/>
    <!--[if lt IE 10]>
      <script src="https://as.alipayobjects.com/g/component/??console-polyfill/0.2.2/index.js,es5-shim/4.5.7/es5-shim.min.js,es5-shim/4.5.7/es5-sham.min.js,html5shiv/3.7.2/html5shiv.min.js,media-match/2.0.2/media.match.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div id="react-content"><div class="layout" data-reactroot="" data-reactid="1" data-react-checksum="360094523"><div class="paper" data-reactid="2"><header class="layout-header" data-reactid="3"><div class="header-content" data-reactid="4"><div class="title" data-reactid="5"><a href="/" data-reactid="6"><img class="logo" src="http://oaul0t4t1.bkt.clouddn.com/imgs/blog-logo.jpg" alt="logo" data-reactid="7"/></a></div><div class="nav" data-reactid="8"><ul data-reactid="9"><li class="to-home" data-reactid="10"><a href="/" data-reactid="11">Home</a></li><li data-reactid="12"><span data-reactid="13">Journal</span></li><li data-reactid="14"><span data-reactid="15">Artwork</span></li><li data-reactid="16"><span data-reactid="17">JS</span></li><li data-reactid="18"><span data-reactid="19">About</span></li><li data-reactid="20"><span data-reactid="21">Vita</span></li></ul></div><div class="header-bottom-line" data-reactid="22"></div></div></header><div class="layout-content" data-reactid="23"><div class="post-info" data-reactid="24"><span data-reactid="25"><i class="mineicon mineicon-clock" data-reactid="26"></i><time data-reactid="27">2017-05-22</time></span><span data-reactid="28"><i class="mineicon mineicon-sale" data-reactid="29"></i><span class="tags" data-reactid="30"><a href="/" data-reactid="31">JS</a></span></span></div><h1 data-reactid="32">关于{纯}函数</h1><div class="entry-content" data-reactid="33"><article data-reactid="34"><p data-reactid="35"><!-- react-text: 36 -->近来在写一个 <!-- /react-text --><code data-reactid="37"><!-- react-text: 38 -->Vue<!-- /react-text --></code><!-- react-text: 39 --> 组件时遇见这样一件事情，一个组件使用者在使用组件时，将一个实例对象使用 <!-- /react-text --><code data-reactid="40"><!-- react-text: 41 -->Props<!-- /react-text --></code><!-- react-text: 42 --> 传入了组件内部，组件处理完成后通过 <!-- /react-text --><code data-reactid="43"><!-- react-text: 44 -->emit<!-- /react-text --></code><!-- react-text: 45 --> 发送给了组件外部，然而使用者随即就将该结果再次赋值给了 <!-- /react-text --><code data-reactid="46"><!-- react-text: 47 -->Props<!-- /react-text --></code><!-- react-text: 48 --> 相同的对象，使得组件执行递归反复处理了几次才最总得到了非期许的值。<!-- /react-text --></p><p data-reactid="49"><!-- react-text: 50 -->这让我觉得非常的尴尬，要我觉得组件本身是没有问题的。就组件本身而言无非就是将 UI 和处理逻辑封装起来根据输入得到输出，仅此而已。之所以得到一个非期许的值，举个简单的例子来解释：<!-- /react-text --></p><pre class="language-js" data-reactid="51"><code data-reactid="52"><span class="token keyword">let</span> exArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> exArray<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>exArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    exArray<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>exArray<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// => [3, 5, 7, 9, 2]</span></code></pre><p data-reactid="53"><!-- react-text: 54 -->上面的例子试图通过遍历数组来删除掉小于 5 的元素，然而结果不尽人意。为什么？如果把 for 循环体看做一个函数的话，那么每一次的删除操作都破坏了原先正确传入函数的参数，即数组的长度发生了改变，导致个别元素被异常跳过了。<!-- /react-text --></p><p data-reactid="55"><!-- react-text: 56 -->我认为更优秀的实现方式应该是：<!-- /react-text --></p><pre class="language-js" data-reactid="57"><code data-reactid="58"><span class="token keyword">let</span> exArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> reArray <span class="token operator">=</span> exArray<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>val <span class="token operator">=</span><span class="token operator">></span> val <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>exArray<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// => [1, 3, 5, 7, 3, 9, 4, 2]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reArray<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// => [1, 3, 3, 4, 2]</span></code></pre><blockquote data-reactid="59"><p data-reactid="60"><!-- react-text: 61 -->我们一般写函数都讲究一个<!-- /react-text --><strong data-reactid="62"><!-- react-text: 63 -->纯<!-- /react-text --></strong><!-- react-text: 64 -->字，既函数<!-- /react-text --><strong data-reactid="65"><!-- react-text: 66 -->对当做参数传入的对象不具有破坏性<!-- /react-text --></strong><!-- react-text: 67 -->，同时也<!-- /react-text --><strong data-reactid="68"><!-- react-text: 69 -->对依赖和更改保持诚实<!-- /react-text --></strong><!-- react-text: 70 -->，才能保证不污染外部状态。只要函数做到了尽可能的纯那么就足够了，不需要承担过多的处理逻辑，组件设计亦然。<!-- /react-text --></p></blockquote></article></div><div class="post-footer" data-reactid="71"><div class="post-footer-line" data-reactid="72"></div><a class="previous" href="posts/disconf" data-reactid="73"><i class="mineicon mineicon-arrowleft" data-reactid="74"></i><!-- react-text: 75 --> <!-- /react-text --><span class="label" data-reactid="76">prev</span><span class="post-title" data-reactid="77">Disconf 分布式配置管理平台</span></a><div class="comment-tip" data-reactid="78"><span data-reactid="79">⌘+enter post comment</span></div><a class="next" href="posts/test" data-reactid="80"><span class="post-title" data-reactid="81">测试文章</span><span class="label" data-reactid="82">next</span><!-- react-text: 83 --> <!-- /react-text --><i class="mineicon mineicon-arrowright" data-reactid="84"></i></a></div></div></div><footer data-reactid="85"><span class="linkup" data-reactid="86"><a href="http://github.com/jazzysnail" target="_blank" data-reactid="87"><i class="mineicon mineicon-github" data-reactid="88"></i></a><a href="http://2017.zcool.com.cn/u/2061043" target="_blank" data-reactid="89"><i class="mineicon mineicon-zcool" data-reactid="90"></i></a></span><p data-reactid="91"><!-- react-text: 92 -->All Content Copyright © <!-- /react-text --><!-- react-text: 93 -->2016<!-- /react-text --><!-- react-text: 94 -->-<!-- /react-text --><!-- react-text: 95 -->2017<!-- /react-text --><!-- react-text: 96 --> leon’s blog<!-- /react-text --></p><p style="color:#ccc;" data-reactid="97"><!-- react-text: 98 -->Powered by <!-- /react-text --><a href="https://github.com/benjycui/bisheng" data-reactid="99">Bisheng</a></p></footer></div></div>
  </body>
  <script src="/common.js"></script>
  <script src="/index.js"></script>
</html>